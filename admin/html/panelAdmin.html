<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panel Administrativo</title>

    <link rel="stylesheet" href="/admin/css/admin.css" />
    <link rel="stylesheet" href="/admin/css/admin-shared.css" />
    <link rel="stylesheet" href="/admin/css/secciones/pdf-config.css" />
    <link rel="stylesheet" href="/admin/css/secciones/admin-user-management.css" />
    <link rel="stylesheet" href="/admin/css/admin-responsive.css" />
    <link rel="stylesheet" href="/admin/css/secciones/general-config.css" />
    <link rel="stylesheet" href="/admin/css/panelAdmin.css" />
    <link rel="stylesheet" href="/admin/css/secciones/database.css" />
    <link rel="stylesheet" href="/admin/css/secciones/backgrounds.css" />
    <link rel="stylesheet" href="/css/themeSelector.css" />
    <link rel="stylesheet" href="/css/restoreConfirmModal.css" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />

    <!-- Inicialización temprana del tema - NO aplica tema, solo prepara para themeManager -->
    <script>
      (function () {
        // Solo preparar configuración inicial, NO aplicar tema
        // themeManager.js se encargará de aplicar el tema correcto
        const availableThemes = [
          "orange",
          "blue",
          "green",
          "purple",
          "red",
          "teal",
          "dark",
        ];

        // Leer configuración actual para que themeManager la considere
        const storedTheme = localStorage.getItem("selectedTheme");
        const storedCustomColor = localStorage.getItem("customColor");

        // NO aplicar tema aquí - dejar que themeManager.js lo haga
        // Esto evita conflictos entre la inicialización y el sistema unificado
      })();

      // Verificación inicial de autenticación
      (function () {
        const urlParams = new URLSearchParams(window.location.search);
        const tokenId = urlParams.get("tid");
        const token = localStorage.getItem("token");

        // Si no hay tokenId ni token, redirigir al login
        if (!tokenId && !token) {
          console.log(
            "🔐 No hay token de administración, redirigiendo al login"
          );
          window.location.href = "/adminLogin";
          return;
        }

        // Si hay token pero no tokenId, dejar que panelAdmin.js valide el token
        if (!tokenId && token) {
          console.log(
            "🔐 Token existente encontrado, validando con panelAdmin.js"
          );
          // No redirigir, dejar que panelAdmin.js maneje la validación
          return;
        }

        // Si hay tokenId, proceder normalmente (dejará que panelAdmin.js lo maneje)
        console.log(
          "🔐 TokenId presente, procediendo con autenticación normal"
        );
      })();

      // Script para mejorar formularios administrativos
      (function() {
        document.addEventListener('DOMContentLoaded', function() {
          // Inicializar efectos de foco en grupos de formulario
          // Esto se maneja ahora desde panelAdmin.js para evitar duplicación

          // Función para toggle de contraseña
          window.togglePasswordVisibility = function(inputId) {
            const input = document.getElementById(inputId);
            const toggleBtn = input.nextElementSibling;

            if (input && toggleBtn) {
              const isPassword = input.type === 'password';
              input.type = isPassword ? 'text' : 'password';

              // Actualizar el icono del botón
              const svg = toggleBtn.querySelector('svg');
              if (svg) {
                if (isPassword) {
                  // Cambiar a icono de "ocultar"
                  svg.innerHTML = `
                    <path d="M2.99902 3L20.999 21M9.8433 9.91364C9.32066 10.4536 8.99902 11.1892 8.99902 12C8.99902 13.6569 10.3422 15 11.999 15C12.8215 15 13.5667 14.669 14.1086 14.133M6.49902 6.64715C4.59972 7.90034 3.15305 9.78394 2.45703 12C3.73128 16.0571 7.52159 19 11.9992 19C13.9881 19 15.8414 18.4194 17.3988 17.4184M10.999 5.04939C11.328 5.01673 11.6617 5 11.9992 5C16.4769 5 20.2672 7.94291 21.5414 12C21.2607 12.894 20.8577 13.7338 20.3522 14.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  `;
                } else {
                  // Cambiar a icono de "mostrar"
                  svg.innerHTML = `
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2"/>
                    <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                  `;
                }
              }

              // Sin animación
            }
          };
        });
      })();
    </script>
  </head>
  <body class="admin-body" data-bg="default">
    <!-- Header administrativo -->
    <header class="admin-header">
      <div class="admin-header-content">
        <!-- Botón hamburguesa para móvil -->
        <button
          class="admin-mobile-toggle"
          id="mobileToggleBtn"
          aria-label="Abrir menú"
        >
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path
              d="M3 12h18M3 6h18M3 18h18"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
          </svg>
        </button>
        <div class="admin-logo">
          <svg
            width="32"
            height="32"
            viewBox="0 0 24 24"
            fill="none"
            class="admin-logo-icon"
          >
            <rect
              x="3"
              y="4"
              width="18"
              height="18"
              rx="2"
              ry="2"
              stroke="currentColor"
              stroke-width="2"
            />
            <line
              x1="16"
              y1="2"
              x2="16"
              y2="6"
              stroke="currentColor"
              stroke-width="2"
            />
            <line
              x1="8"
              y1="2"
              x2="8"
              y2="6"
              stroke="currentColor"
              stroke-width="2"
            />
            <line
              x1="3"
              y1="10"
              x2="21"
              y2="10"
              stroke="currentColor"
              stroke-width="2"
            />
            <path d="M8 14h.01" stroke="currentColor" stroke-width="2" />
            <path d="M12 14h.01" stroke="currentColor" stroke-width="2" />
            <path d="M16 14h.01" stroke="currentColor" stroke-width="2" />
            <path d="M8 18h.01" stroke="currentColor" stroke-width="2" />
            <path d="M12 18h.01" stroke="currentColor" stroke-width="2" />
          </svg>
          <div class="admin-logo-text">
            <h1>Panel de Administración</h1>
            <span id="adminHeaderSubtitle">Sistema de Firmas Digitales</span>
          </div>
        </div>

        <div class="admin-header-actions">
          <!-- Indicador de usuario activo -->
          <div class="admin-user-indicator" id="admin-user-indicator" style="display: none;">
            <div class="admin-user-avatar">U</div>
            <div class="admin-user-info">
              <span class="admin-user-name">Cargando...</span>
              <span class="admin-user-role">Verificando...</span>
            </div>
            <div class="admin-user-status"></div>
          </div>

          <!-- Botón para volver al sitio principal -->
          <button
            class="admin-btn secondary main-site-btn"
            id="mainSiteBtn"
            onclick="goToMainSite()"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
              <path
                d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"
                stroke="currentColor"
                stroke-width="2"
              />
              <polyline
                points="9,22 9,12 15,12 15,22"
                stroke="currentColor"
                stroke-width="2"
              />
            </svg>
            Ir al Sitio
          </button>
        </div>
      </div>
    </header>

    <!-- Layout principal -->
    <div class="admin-layout">
      <!-- Sidebar de navegación -->
      <aside class="admin-sidebar">
        <nav class="admin-nav">
          <div class="admin-nav-section">
            <h3>Configuración</h3>
            <button
              class="admin-nav-item active"
              data-tab="configuracion-general"
            >
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <circle
                  cx="12"
                  cy="12"
                  r="3"
                  stroke="currentColor"
                  stroke-width="2"
                />
                <path
                  d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"
                  stroke="currentColor"
                  stroke-width="2"
                />
              </svg>
              <span>Configuración General</span>
            </button>
          </div>

          <div class="admin-nav-section">
            <h3>Usuarios</h3>
            <button class="admin-nav-item" data-tab="gestion-usuarios">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path
                  d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"
                  stroke="currentColor"
                  stroke-width="2"
                />
                <circle
                  cx="12"
                  cy="7"
                  r="4"
                  stroke="currentColor"
                  stroke-width="2"
                />
              </svg>
              <span>Gestión de Usuarios</span>
            </button>
          </div>

          <div class="admin-nav-section">
            <h3>Personalización</h3>

            <button class="admin-nav-item" data-tab="temas-colores">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path
                  d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              <span>Temas y Colores</span>
            </button>

            <button class="admin-nav-item" data-tab="configuracion-pdf">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path
                  d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
                  stroke="currentColor"
                  stroke-width="2"
                />
                <polyline
                  points="14,2 14,8 20,8"
                  stroke="currentColor"
                  stroke-width="2"
                />
                <line
                  x1="16"
                  y1="13"
                  x2="8"
                  y2="13"
                  stroke="currentColor"
                  stroke-width="2"
                />
                <line
                  x1="16"
                  y1="17"
                  x2="8"
                  y2="17"
                  stroke="currentColor"
                  stroke-width="2"
                />
                <polyline
                  points="10,9 9,9 8,9"
                  stroke="currentColor"
                  stroke-width="2"
                />
              </svg>
              <span>Configuración PDF</span>
            </button>
          </div>

          <div class="admin-nav-section">
            <h3>Sistema</h3>
            <button class="admin-nav-item" data-tab="base-datos">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <ellipse
                  cx="12"
                  cy="5"
                  rx="9"
                  ry="3"
                  stroke="currentColor"
                  stroke-width="2"
                />
                <path
                  d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"
                  stroke="currentColor"
                  stroke-width="2"
                />
                <path
                  d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"
                  stroke="currentColor"
                  stroke-width="2"
                />
              </svg>
              <span>Base de Datos</span>
            </button>

            <button class="admin-nav-item" data-tab="sistema-avanzado">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path
                  d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"
                  stroke="currentColor"
                  stroke-width="2"
                />
                <circle
                  cx="12"
                  cy="12"
                  r="3"
                  stroke="currentColor"
                  stroke-width="2"
                />
              </svg>
              <span>Sistema Avanzado</span>
            </button>
          </div>
        </nav>

        <!-- Contenedor para botón móvil -->
        <div class="admin-sidebar-mobile-actions" id="sidebarMobileActions">
          <button
            class="admin-btn secondary main-site-btn-mobile"
            onclick="goToMainSite()"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
              <path
                d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"
                stroke="currentColor"
                stroke-width="2"
              />
              <polyline
                points="9,22 9,12 15,12 15,22"
                stroke="currentColor"
                stroke-width="2"
              />
            </svg>
            <span>Volver al Sitio</span>
          </button>
        </div>
      </aside>

      <!-- Contenido principal -->
      <main class="admin-main">
        <!-- Dashboard de métricas -->
        <div class="admin-metrics" id="adminMetrics">
          <div class="metric-card">
            <div class="metric-icon users">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path
                  d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"
                  stroke="currentColor"
                  stroke-width="2"
                />
                <circle
                  cx="12"
                  cy="7"
                  r="4"
                  stroke="currentColor"
                  stroke-width="2"
                />
              </svg>
            </div>
            <div class="metric-content">
              <h4>Usuarios Totales</h4>
              <span class="metric-value" id="totalUsers">--</span>
              <span class="metric-change positive">+3 este mes</span>
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-icon documents">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path
                  d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
                  stroke="currentColor"
                  stroke-width="2"
                />
                <polyline
                  points="14,2 14,8 20,8"
                  stroke="currentColor"
                  stroke-width="2"
                />
                <line
                  x1="16"
                  y1="13"
                  x2="8"
                  y2="13"
                  stroke="currentColor"
                  stroke-width="2"
                />
                <line
                  x1="16"
                  y1="17"
                  x2="8"
                  y2="17"
                  stroke="currentColor"
                  stroke-width="2"
                />
              </svg>
            </div>
            <div class="metric-content">
              <h4>Documentos Firmados</h4>
              <span class="metric-value" id="totalDocs">--</span>
              <span class="metric-change positive">+12 esta semana</span>
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-icon keys">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path
                  d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"
                  stroke="currentColor"
                  stroke-width="2"
                />
              </svg>
            </div>
            <div class="metric-content">
              <h4>Llaves Activas</h4>
              <span class="metric-value" id="totalKeys">--</span>
              <span class="metric-change neutral">Sin cambios</span>
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-icon status">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <circle
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  stroke-width="2"
                />
                <path
                  d="M9 12l2 2 4-4"
                  stroke="currentColor"
                  stroke-width="2"
                />
              </svg>
            </div>
            <div class="metric-content">
              <h4>Estado del Sistema</h4>
              <span class="metric-value text">Óptimo</span>
              <span class="metric-change positive">100% uptime</span>
            </div>
          </div>
        </div>

        <!-- Contenido de pestañas -->
        <div class="admin-content">
          <!-- TAB 1: CONFIGURACIÓN GENERAL -->
          <div class="admin-tab-content active" id="tab-configuracion-general">
            <h2>Configuración General</h2>
            <p class="tab-description">
              Configura la identidad principal de tu institución
            </p>

            <div class="admin-section">
              <h3>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--admin-accent)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M4 6c3-1 6 1 8 0s6-1 8 0v12c-3 1-6-1-8 0s-6 1-8 0V6z"/>
                </svg>
                Identidad de la Institución
              </h3>

              <!-- Contenedor principal con flexbox -->
              <div class="admin-section-content">
                <!-- Campo 1: Identidad de la Institución -->
                <div class="admin-field institution-field">
                  <div class="field-header">
                    <h4>Nombre de la Institución</h4>
                  </div>
                  <div class="field-content">
                    <input
                      type="text"
                      id="institutionName"
                      placeholder="Ej: Universidad Nacional"
                      class="admin-input"
                      value="Firmas Digitales FD"
                    />
                    <span class="admin-input-help">
                      Este nombre se usará en el header, footer, título de la página y otros elementos del sitio
                    </span>
                  </div>
                </div>

                <!-- Campo 2: Favicon -->
                <div class="admin-field favicon-field">
                  <div class="field-header">
                    <h4>Favicon del Sitio</h4>
                  </div>
                  <div class="field-content">
                    <div class="favicon-preview">
                      <img id="currentFavicon" src="../../../favicon.ico" alt="Favicon actual" />
                      <span>Favicon Actual</span>
                    </div>
                    <div class="favicon-controls">
                      <label for="faviconUpload">Cambiar favicon:</label>
                      <button class="visual-config-btn secondary select-file-btn" onclick="selectFaviconFile()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                          <polyline points="7,10 12,15 17,10"/>
                          <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        Seleccionar Archivo
                      </button>
                      <span class="admin-input-help">Formatos: ICO, PNG, JPG (32x32px recomendado)</span>
                      <input
                        type="file"
                        id="faviconUpload"
                        accept="image/x-icon,image/png,image/jpeg,image/gif"
                        onchange="handleFaviconChange(event)"
                        style="display: none;"
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Botón General de Guardar Configuración -->
            <div class="global-config-actions">
              <button class="admin-btn primary large" onclick="saveGlobalConfiguration()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                  <path
                    d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                  <polyline
                    points="17,21 17,13 7,13 7,21"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                  <polyline
                    points="7,3 7,8 15,8"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                </svg>
                Guardar Configuración Global
              </button>
            </div>
          </div>

          <!-- TAB 2: GESTIÓN DE USUARIOS -->
          <div class="admin-tab-content" id="tab-gestion-usuarios">
            <h2>Gestión de Usuarios</h2>
            <p class="tab-description">
              Administra las cuentas de usuario y sus permisos
            </p>

            <div class="admin-section">
              <div class="admin-section-header">
                <h3>
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path
                      d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"
                      stroke="currentColor"
                      stroke-width="2"
                    />
                    <circle
                      cx="9"
                      cy="7"
                      r="4"
                      stroke="currentColor"
                      stroke-width="2"
                    />
                    <path
                      d="M22 21v-2a4 4 0 0 0-3-3.87"
                      stroke="currentColor"
                      stroke-width="2"
                    />
                    <path
                      d="M16 3.13a4 4 0 0 1 0 7.75"
                      stroke="currentColor"
                      stroke-width="2"
                    />
                  </svg>
                  Crear Nuevo Usuario
                </h3>
                <button class="admin-btn primary" onclick="toggleUserForm()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                    <line
                      x1="12"
                      y1="5"
                      x2="12"
                      y2="19"
                      stroke="currentColor"
                      stroke-width="2"
                    />
                    <line
                      x1="5"
                      y1="12"
                      x2="19"
                      y2="12"
                      stroke="currentColor"
                      stroke-width="2"
                    />
                  </svg>
                  Nuevo Usuario
                </button>
              </div>

              <!-- Formulario de creación de usuario (oculto por defecto) -->
              <div
                class="user-form-container"
                id="userFormContainer"
                style="display: none"
              >
                <form class="admin-form" id="createUserForm">
                  <div class="admin-form-grid">
                    <div class="admin-form-group">
                      <label for="userFullName">Nombre Completo *</label>
                      <input
                        type="text"
                        id="userFullName"
                        name="name"
                        required
                        class="admin-input"
                        placeholder="Juan Pérez García"
                      />
                    </div>

                    <div class="admin-form-group">
                      <label for="userIdNumber">Número de ID *</label>
                      <input
                        type="text"
                        id="userIdNumber"
                        name="idNumber"
                        required
                        class="admin-input"
                        placeholder="12345678"
                      />
                    </div>

                    <div class="admin-form-group">
                      <label for="userName">Nombre de Usuario *</label>
                      <input
                        type="text"
                        id="userName"
                        name="username"
                        required
                        class="admin-input"
                        placeholder="jperez"
                      />
                      <span class="admin-input-help"
                        >Solo letras, números y guiones bajos</span
                      >
                    </div>

                    <div class="admin-form-group">
                      <label for="userPassword">Contraseña *</label>
                      <div class="password-input-container">
                        <input
                          type="password"
                          id="userPassword"
                          name="password"
                          required
                          class="admin-input"
                          placeholder="••••••••"
                        />
                        <button
                          type="button"
                          class="password-toggle"
                          onclick="togglePasswordVisibility('userPassword')"
                        >
                          <svg
                            width="16"
                            height="16"
                            viewBox="0 0 24 24"
                            fill="none"
                          >
                            <path
                              d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"
                              stroke="currentColor"
                              stroke-width="2"
                            />
                            <circle
                              cx="12"
                              cy="12"
                              r="3"
                              stroke="currentColor"
                              stroke-width="2"
                            />
                          </svg>
                        </button>
                      </div>
                    </div>

                    <div class="admin-form-group">
                      <label for="userRole">Rol del Usuario *</label>
                      <select id="userRole" name="role" required class="admin-select">
                        <option value="">Seleccionar rol...</option>
                        <option value="user">Usuario</option>
                        <option value="admin">Administrador</option>
                        <option value="owner">Propietario</option>
                      </select>
                      <span class="admin-input-help"
                        >Los administradores tienen acceso completo al
                        sistema</span
                      >
                    </div>

                    <div class="admin-form-group">
                      <label for="userEmail">Correo Electrónico *</label>
                      <input
                        type="email"
                        id="userEmail"
                        name="email"
                        required
                        class="admin-input"
                        placeholder="usuario@universidad.edu"
                      />
                    </div>
                  </div>

                  <div class="admin-form-actions">
                    <button type="submit" class="admin-btn success">
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                      >
                        <path
                          d="M20 6L9 17l-5-5"
                          stroke="currentColor"
                          stroke-width="2"
                        />
                      </svg>
                      Crear Usuario
                    </button>
                    <button
                      type="button"
                      class="admin-btn secondary"
                      onclick="cancelUserForm()"
                    >
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                      >
                        <line
                          x1="18"
                          y1="6"
                          x2="6"
                          y2="18"
                          stroke="currentColor"
                          stroke-width="2"
                        />
                        <line
                          x1="6"
                          y1="6"
                          x2="18"
                          y2="18"
                          stroke="currentColor"
                          stroke-width="2"
                        />
                      </svg>
                      Cancelar
                    </button>
                  </div>
                </form>
              </div>

              <!-- Lista de usuarios existentes -->
              <div class="users-list-container">
                <h4>Usuarios Existentes</h4>
                <div class="users-list" id="usersList">
                  <!-- Los usuarios se cargarán dinámicamente -->
                </div>
              </div>
            </div>
          </div>

          <!-- TAB 3: PERSONALIZACIÓN VISUAL -->
          <div class="admin-tab-content" id="tab-temas-colores">
            <h2>Temas y Colores</h2>
            <p class="tab-description">
              Configura la apariencia y temas del sitio web. Los cambios se
              aplicarán globalmente para todos los usuarios.
            </p>

            <!-- Sistema de Temas Dinámicos -->
            <div class="admin-theme-selector">
              <div class="theme-control-section">
                <div class="theme-control-header">
                  <svg
                    class="theme-icon"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                  >
                    <circle
                      cx="12"
                      cy="12"
                      r="5"
                      stroke="currentColor"
                      stroke-width="2"
                    />
                    <path
                      d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"
                      stroke="currentColor"
                      stroke-width="2"
                    />
                  </svg>
                  <h3>Temas Predefinidos</h3>
                </div>

                <div class="theme-grid" id="adminThemeGrid">
                  <div class="theme-option-card" data-theme="orange">
                    <div
                      class="theme-color-preview"
                      style="background: #ff9545"
                    ></div>
                    <span class="theme-name">Naranja</span>
                  </div>

                  <div class="theme-option-card" data-theme="blue">
                    <div
                      class="theme-color-preview"
                      style="background: #3b82f6"
                    ></div>
                    <span class="theme-name">Azul</span>
                  </div>

                  <div class="theme-option-card" data-theme="green">
                    <div
                      class="theme-color-preview"
                      style="background: #10b981"
                    ></div>
                    <span class="theme-name">Verde</span>
                  </div>

                  <div class="theme-option-card" data-theme="purple">
                    <div
                      class="theme-color-preview"
                      style="background: #8b5cf6"
                    ></div>
                    <span class="theme-name">Morado</span>
                  </div>

                  <div class="theme-option-card" data-theme="red">
                    <div
                      class="theme-color-preview"
                      style="background: #ef4444"
                    ></div>
                    <span class="theme-name">Rojo</span>
                  </div>

                  <div class="theme-option-card" data-theme="teal">
                    <div
                      class="theme-color-preview"
                      style="background: #14b8a6"
                    ></div>
                    <span class="theme-name">Teal</span>
                  </div>
                </div>

                <!-- Color Personalizado -->
                <div class="custom-color-section">
                  <div class="custom-color-header">
                    <h4>Color Personalizado</h4>
                    <p class="custom-color-description">
                      Elige un color personalizado para tu sitio web
                    </p>
                  </div>

                  <div class="custom-color-input-group">
                    <div class="color-input-wrapper">
                      <input
                        type="color"
                        id="customColorPicker"
                        class="custom-color-input"
                        value="#ff9545"
                      />
                    </div>
                    <input
                      type="text"
                      id="hexColorInput"
                      class="hex-input"
                      value="#ff9545"
                      placeholder="#000000"
                      maxlength="7"
                    />
                    <button class="apply-custom-btn" id="applyCustomColor">
                      Aplicar
                    </button>
                  </div>
                </div>

                <!-- Acciones -->
                <div class="theme-actions">
                  <button class="reset-theme" id="resetThemeBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                      <path
                        d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"
                        stroke="currentColor"
                        stroke-width="2"
                        fill="none"
                      />
                      <path
                        d="M3 3v5h5"
                        stroke="currentColor"
                        stroke-width="2"
                      />
                    </svg>
                    Restaurar por Defecto
                  </button>

                  <button class="save-global-theme" id="saveGlobalTheme">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                      <path
                        d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"
                        stroke="currentColor"
                        stroke-width="2"
                      />
                      <polyline
                        points="17,21 17,13 7,13 7,21"
                        stroke="currentColor"
                        stroke-width="2"
                      />
                      <polyline
                        points="7,3 7,8 15,8"
                        stroke="currentColor"
                        stroke-width="2"
                      />
                    </svg>
                    Guardar Configuración Global
                  </button>
                </div>
              </div>
            </div>

            <!-- Sistema de Backgrounds -->
            <div class="background-selector">
              <div class="background-control-section">
                <div class="background-control-header">
                  <svg
                    class="background-icon"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                  >
                    <rect
                      x="3"
                      y="3"
                      width="18"
                      height="18"
                      rx="2"
                      ry="2"
                      stroke="currentColor"
                      stroke-width="2"
                    />
                    <circle
                      cx="9"
                      cy="9"
                      r="2"
                      stroke="currentColor"
                      stroke-width="2"
                    />
                    <path
                      d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"
                      stroke="currentColor"
                      stroke-width="2"
                    />
                  </svg>
                  <h3>Backgrounds del Sitio</h3>
                </div>

                <!-- Grid de opciones de background - Estilos aplicados en admin.css -->
                <div class="background-grid">
                  <div class="background-option-card" data-bg="fondo1">
                    <div class="background-preview">
                      <img
                        src="../../../recursos/Fondo.jpg"
                        alt="Background 1"
                        class="background-image"
                      />
                    </div>
                    <span class="background-name">Fondo Principal</span>
                  </div>

                  <div class="background-option-card" data-bg="fondo2">
                    <div class="background-preview">
                      <img
                        src="../../../recursos/Fondo2.jpg"
                        alt="Background 2"
                        class="background-image"
                      />
                    </div>
                    <span class="background-name">Fondo Secundario</span>
                  </div>
                </div>

                <!-- Acciones de Background -->
                <div class="background-actions">
                  <button class="reset-background" id="resetBackgroundBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                      <path
                        d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"
                        stroke="currentColor"
                        stroke-width="2"
                        fill="none"
                      />
                      <path
                        d="M3 3v5h5"
                        stroke="currentColor"
                        stroke-width="2"
                      />
                    </svg>
                    Restaurar por Defecto
                  </button>

                  <button class="save-global-background" id="saveGlobalBackground">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                      <path
                        d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"
                        stroke="currentColor"
                        stroke-width="2"
                      />
                      <polyline
                        points="17,21 17,13 7,13 7,21"
                        stroke="currentColor"
                        stroke-width="2"
                      />
                      <polyline
                        points="7,3 7,8 15,8"
                        stroke="currentColor"
                        stroke-width="2"
                      />
                    </svg>
                    Guardar Configuración Global
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- TAB 4: CONFIGURACIÓN PDF -->
          <div class="admin-tab-content" id="tab-configuracion-pdf">
            <h2>Configuración de PDFs</h2>
            <p class="tab-description">
              Personaliza las plantillas y configuraciones de documentos PDF con opciones avanzadas
            </p>

            <!-- SECCIÓN 1: PLANTILLA PRINCIPAL -->
            <div class="admin-section">
              <h3>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path
                    d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                  <polyline
                    points="14,2 14,8 20,8"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                  <line
                    x1="16"
                    y1="13"
                    x2="8"
                    y2="13"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                  <line
                    x1="16"
                    y1="17"
                    x2="8"
                    y2="17"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                </svg>
                Plantilla Principal
              </h3>

              <div class="admin-form-grid">
                <div class="admin-form-group">
                  <label for="pdfSelectedTemplate">Plantilla Seleccionada</label>
                  <select id="pdfSelectedTemplate" class="admin-select">
                    <option value="clasico">Diseño Clásico</option>
                    <option value="moderno">Diseño Moderno</option>
                    <option value="minimalista">Diseño Minimalista</option>
                    <option value="elegante">Diseño Elegante</option>
                    <option value="custom">Personalizado</option>
                  </select>
                  <span class="admin-input-help">Elige la plantilla base para todos los PDFs</span>
                </div>
              </div>
            </div>

            <!-- SECCIÓN 2: CONFIGURACIÓN DE COLORES -->
            <div class="admin-section">
              <h3>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path
                    d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                </svg>
                Configuración de Colores
              </h3>

              <div class="admin-form-grid">
                <div class="admin-form-group">
                  <label for="pdfPrimaryColor">Color Primario</label>
                  <input
                    type="color"
                    id="pdfPrimaryColor"
                    class="admin-input color-input"
                    value="#2563eb"
                  />
                  <span class="admin-input-help">Color principal para títulos y elementos destacados</span>
                </div>

                <div class="admin-form-group">
                  <label for="pdfSecondaryColor">Color Secundario</label>
                  <input
                    type="color"
                    id="pdfSecondaryColor"
                    class="admin-input color-input"
                    value="#64748b"
                  />
                  <span class="admin-input-help">Color para subtítulos y elementos secundarios</span>
                </div>

                <div class="admin-form-group">
                  <label for="pdfAccentColor">Color de Acento</label>
                  <input
                    type="color"
                    id="pdfAccentColor"
                    class="admin-input color-input"
                    value="#f59e0b"
                  />
                  <span class="admin-input-help">Color para elementos decorativos y enlaces</span>
                </div>

                <div class="admin-form-group">
                  <label for="pdfTextColor">Color de Texto</label>
                  <input
                    type="color"
                    id="pdfTextColor"
                    class="admin-input color-input"
                    value="#1f2937"
                  />
                  <span class="admin-input-help">Color principal del texto del documento</span>
                </div>
              </div>
            </div>

            <!-- SECCIÓN 3: CONFIGURACIÓN DE FUENTES -->
            <div class="admin-section">
              <h3>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path
                    d="M4 7V4h16v3M9 20h6M12 4v16"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                </svg>
                Configuración de Fuentes
              </h3>

              <div class="admin-form-grid">
                <div class="admin-form-group">
                  <label for="pdfTitleFont">Fuente de Títulos</label>
                  <select id="pdfTitleFont" class="admin-select">
                    <option value="Helvetica-Bold">Helvetica Bold</option>
                    <option value="Times-Bold">Times Bold</option>
                    <option value="Courier-Bold">Courier Bold</option>
                  </select>
                  <span class="admin-input-help">Fuente para títulos principales del documento</span>
                </div>

                <div class="admin-form-group">
                  <label for="pdfBodyFont">Fuente del Cuerpo</label>
                  <select id="pdfBodyFont" class="admin-select">
                    <option value="Helvetica">Helvetica</option>
                    <option value="Times-Roman">Times Roman</option>
                    <option value="Courier">Courier</option>
                  </select>
                  <span class="admin-input-help">Fuente para el texto principal del documento</span>
                </div>

                <div class="admin-form-group">
                  <label for="pdfMetadataFont">Fuente de Metadatos</label>
                  <select id="pdfMetadataFont" class="admin-select">
                    <option value="Helvetica-Oblique">Helvetica Italic</option>
                    <option value="Times-Italic">Times Italic</option>
                    <option value="Courier-Oblique">Courier Italic</option>
                  </select>
                  <span class="admin-input-help">Fuente para fechas, autores y metadatos</span>
                </div>

                <div class="admin-form-group">
                  <label for="pdfSignatureFont">Fuente de Firma</label>
                  <select id="pdfSignatureFont" class="admin-select">
                    <option value="Times-Bold">Times Bold</option>
                    <option value="Helvetica-Bold">Helvetica Bold</option>
                    <option value="Courier-Bold">Courier Bold</option>
                  </select>
                  <span class="admin-input-help">Fuente para el texto de la firma digital</span>
                </div>
              </div>
            </div>

            <!-- SECCIÓN 4: CONFIGURACIÓN DE LAYOUT -->
            <div class="admin-section">
              <h3>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <rect
                    x="3"
                    y="3"
                    width="18"
                    height="18"
                    rx="2"
                    ry="2"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                  <line
                    x1="9"
                    y1="9"
                    x2="15"
                    y2="9"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                  <line
                    x1="9"
                    y1="15"
                    x2="15"
                    y2="15"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                </svg>
                Configuración de Layout
              </h3>

              <div class="admin-form-grid">
                <div class="admin-form-group">
                  <label for="pdfMarginTop">Margen Superior (px)</label>
                  <input
                    type="number"
                    id="pdfMarginTop"
                    class="admin-input"
                    value="60"
                    min="20"
                    max="100"
                  />
                  <span class="admin-input-help">Espacio desde la parte superior de la página</span>
                </div>

                <div class="admin-form-group">
                  <label for="pdfMarginBottom">Margen Inferior (px)</label>
                  <input
                    type="number"
                    id="pdfMarginBottom"
                    class="admin-input"
                    value="60"
                    min="20"
                    max="100"
                  />
                  <span class="admin-input-help">Espacio desde la parte inferior de la página</span>
                </div>

                <div class="admin-form-group">
                  <label for="pdfMarginLeft">Margen Izquierdo (px)</label>
                  <input
                    type="number"
                    id="pdfMarginLeft"
                    class="admin-input"
                    value="50"
                    min="20"
                    max="100"
                  />
                  <span class="admin-input-help">Espacio desde el lado izquierdo de la página</span>
                </div>

                <div class="admin-form-group">
                  <label for="pdfMarginRight">Margen Derecho (px)</label>
                  <input
                    type="number"
                    id="pdfMarginRight"
                    class="admin-input"
                    value="50"
                    min="20"
                    max="100"
                  />
                  <span class="admin-input-help">Espacio desde el lado derecho de la página</span>
                </div>

                <div class="admin-form-group">
                  <label for="pdfLineHeight">Interlineado</label>
                  <input
                    type="number"
                    id="pdfLineHeight"
                    class="admin-input"
                    value="1.6"
                    min="1.0"
                    max="2.5"
                    step="0.1"
                  />
                  <span class="admin-input-help">Espacio entre líneas de texto</span>
                </div>

                <div class="admin-form-group">
                  <label for="pdfTitleSize">Tamaño de Título (pt)</label>
                  <input
                    type="number"
                    id="pdfTitleSize"
                    class="admin-input"
                    value="24"
                    min="16"
                    max="36"
                  />
                  <span class="admin-input-help">Tamaño de fuente para títulos principales</span>
                </div>

                <div class="admin-form-group">
                  <label for="pdfBodySize">Tamaño de Cuerpo (pt)</label>
                  <input
                    type="number"
                    id="pdfBodySize"
                    class="admin-input"
                    value="12"
                    min="8"
                    max="16"
                  />
                  <span class="admin-input-help">Tamaño de fuente para texto principal</span>
                </div>
              </div>
            </div>

            <!-- SECCIÓN 5: CONFIGURACIÓN DE BORDES -->
            <div class="admin-section">
              <h3>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <rect
                    x="3"
                    y="3"
                    width="18"
                    height="18"
                    rx="2"
                    ry="2"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                </svg>
                Configuración de Bordes
              </h3>

              <div class="admin-form-grid">
                <div class="admin-form-group">
                  <label for="pdfBorderStyle">Estilo de Borde</label>
                  <select id="pdfBorderStyle" class="admin-select">
                    <option value="classic">Clásico</option>
                    <option value="modern">Moderno</option>
                    <option value="minimal">Minimalista</option>
                    <option value="elegant">Elegante</option>
                  </select>
                  <span class="admin-input-help">Estilo visual del borde del documento</span>
                </div>

                <div class="admin-form-group">
                  <label for="pdfBorderWidth">Ancho del Borde (px)</label>
                  <input
                    type="number"
                    id="pdfBorderWidth"
                    class="admin-input"
                    value="2"
                    min="1"
                    max="5"
                  />
                  <span class="admin-input-help">Grosor de las líneas del borde</span>
                </div>

                <div class="admin-form-group">
                  <label for="pdfBorderColor">Color del Borde</label>
                  <input
                    type="color"
                    id="pdfBorderColor"
                    class="admin-input color-input"
                    value="#1f2937"
                  />
                  <span class="admin-input-help">Color de las líneas del borde</span>
                </div>

                <div class="admin-form-group">
                  <label for="pdfCornerRadius">Radio de Esquinas (px)</label>
                  <input
                    type="number"
                    id="pdfCornerRadius"
                    class="admin-input"
                    value="0"
                    min="0"
                    max="20"
                  />
                  <span class="admin-input-help">Redondeo de las esquinas del borde</span>
                </div>

                <div class="admin-form-group full-width">
                  <label class="checkbox-label">
                    <input
                      type="checkbox"
                      id="pdfShowDecorative"
                      checked
                    />
                    Mostrar elementos decorativos
                  </label>
                  <span class="admin-input-help">Incluir elementos decorativos en el borde</span>
                </div>
              </div>
            </div>

            <!-- SECCIÓN 6: CONFIGURACIÓN VISUAL -->
            <div class="admin-section">
              <h3>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path
                    d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                  <path
                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                </svg>
                Configuración Visual
              </h3>

              <div class="admin-form-grid">
                <div class="admin-form-group full-width">
                  <label class="checkbox-label">
                    <input
                      type="checkbox"
                      id="pdfShowLogo"
                      checked
                    />
                    Mostrar logo de la institución
                  </label>
                  <span class="admin-input-help">Incluir el logo en los documentos PDF</span>
                </div>

                <div class="admin-form-group full-width">
                  <label class="checkbox-label">
                    <input
                      type="checkbox"
                      id="pdfShowInstitution"
                      checked
                    />
                    Mostrar nombre de la institución
                  </label>
                  <span class="admin-input-help">Incluir el nombre de la institución en el documento</span>
                </div>

                <div class="admin-form-group full-width">
                  <label class="checkbox-label">
                    <input
                      type="checkbox"
                      id="pdfShowDate"
                      checked
                    />
                    Mostrar fecha de creación
                  </label>
                  <span class="admin-input-help">Incluir la fecha en que se creó el documento</span>
                </div>

                <div class="admin-form-group full-width">
                  <label class="checkbox-label">
                    <input
                      type="checkbox"
                      id="pdfShowSignature"
                      checked
                    />
                    Mostrar firma digital
                  </label>
                  <span class="admin-input-help">Incluir la firma electrónica en el documento</span>
                </div>

                <div class="admin-form-group full-width">
                  <label class="checkbox-label">
                    <input
                      type="checkbox"
                      id="pdfShowAuthors"
                      checked
                    />
                    Mostrar autores del documento
                  </label>
                  <span class="admin-input-help">Incluir los nombres de los autores del documento</span>
                </div>

                <div class="admin-form-group full-width">
                  <label class="checkbox-label">
                    <input
                      type="checkbox"
                      id="pdfShowAvalador"
                      checked
                    />
                    Mostrar avalador del documento
                  </label>
                  <span class="admin-input-help">Incluir el nombre de quien avala el documento</span>
                </div>
              </div>
            </div>

            <!-- SECCIÓN 7: LOGO INSTITUCIONAL -->
            <div class="admin-section">
              <h3>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <rect
                    x="3"
                    y="3"
                    width="18"
                    height="18"
                    rx="2"
                    ry="2"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                  <circle
                    cx="9"
                    cy="9"
                    r="2"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                  <path
                    d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                </svg>
                Logo Institucional
              </h3>

              <div class="admin-form-grid">
                <div class="admin-form-group full-width">
                  <div class="logo-preview-section">
                    <label>Vista Previa del Logo</label>
                    <div class="logo-preview-container">
                      <img
                        id="pdfLogoPreview"
                        src="../../recursos/logotipo-de-github.png"
                        alt="Logo Institucional"
                        onerror="this.style.display='none'"
                      />
                      <div class="logo-placeholder" id="logoPlaceholder">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
                          <rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="1" opacity="0.3"/>
                          <circle cx="9" cy="9" r="2" stroke="currentColor" stroke-width="1" opacity="0.5"/>
                          <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21" stroke="currentColor" stroke-width="1" opacity="0.5"/>
                        </svg>
                        <p>Logo no encontrado</p>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="admin-form-group full-width">
                  <label for="pdfLogoPath">Seleccionar Logo</label>
                  <div class="file-input-container">
                    <input
                      type="file"
                      id="pdfLogoPath"
                      class="file-input-hidden"
                      accept="image/*"
                    />
                    <label for="pdfLogoPath" class="file-input-label">
                      <svg class="file-input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" stroke="currentColor" stroke-width="2"/>
                        <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2"/>
                        <circle cx="10" cy="13" r="2" stroke="currentColor" stroke-width="2"/>
                        <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21" stroke="currentColor" stroke-width="2"/>
                      </svg>
                      <span class="file-input-text">Seleccionar imagen</span>
                      <span class="file-input-button">Examinar</span>
                    </label>
                  </div>
                  <span class="admin-input-help">Selecciona un archivo de imagen (PNG, JPG, SVG) para usar como logo en los PDFs</span>
                </div>
              </div>
            </div>

            <!-- ACCIONES -->
            <div class="admin-actions">
              <button class="admin-btn secondary" onclick="previewPdfConfig()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                  <path
                    d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                  <path
                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                </svg>
                Vista Previa
              </button>

              <button class="admin-btn primary" onclick="savePdfConfig()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                  <path
                    d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                  <polyline
                    points="17,21 17,13 7,13 7,21"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                  <polyline
                    points="7,3 7,8 15,8"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                </svg>
                Guardar Configuración
              </button>

              <button class="admin-btn danger" onclick="resetPdfConfig()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                  <polyline points="23,4 23,10 17,10" stroke="currentColor" stroke-width="2"/>
                  <polyline points="1,20 1,14 7,14" stroke="currentColor" stroke-width="2"/>
                  <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15" stroke="currentColor" stroke-width="2"/>
                </svg>
                Restablecer
              </button>
            </div>
          </div>

          <!-- TAB 5: BASE DE DATOS -->
          <div class="admin-tab-content active" id="tab-base-datos">
            <h2>Administración de Base de Datos</h2>
            <p class="tab-description">
              Monitorea y administra la base de datos del sistema con comandos avanzados.
            </p>

            <!-- ADMINISTRACIÓN DE BASE DE DATOS -->
            <div class="db-main-section">
              <!-- PANEL IZQUIERDO: COMANDOS -->
              <div class="db-operations-panel">
                <!-- Header -->
                <div class="db-section-title">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <ellipse cx="12" cy="5" rx="8" ry="3" stroke="currentColor" stroke-width="2"/>
                    <path d="M4 5v6c0 2.5 3.5 4.5 8 4.5s8-2 8-4.5V5" stroke="currentColor" stroke-width="2"/>
                    <path d="M4 11v6c0 2.5 3.5 4.5 8 4.5s8-2 8-4.5v-6" stroke="currentColor" stroke-width="2"/>
                  </svg>
                  <h3>Base de Datos</h3>
                </div>

                <!-- Estado de conexión -->
                <div class="db-status-section">
                  <div class="db-status-card" id="dbStatusCard">
                    <div class="db-status-layout">
                      <div class="db-status-info">
                        <div class="db-status-details">
                          <h5 id="dbStatusTitle">
                            <span>Verificando...</span>
                            <div class="db-status-indicator" id="dbStatusIndicator"></div>
                          </h5>
                          <p id="dbStatusDetails">Conectando a la base de datos</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Comandos -->
                <div class="db-commands-section">
                  <h4>Comandos</h4>
                  <div class="db-commands-grid">
                    <button class="db-cmd-btn" onclick="adminPanel.testDatabaseConnection()" title="Probar conexión">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <polyline points="22,12 18,12 15,21 9,3 6,12 2,12" stroke="currentColor" stroke-width="2"/>
                      </svg>
                      <span>Probar</span>
                    </button>

                    <button class="db-cmd-btn" id="backupDbBtn" onclick="adminPanel.backupDatabase()" title="Crear respaldo">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="currentColor" stroke-width="2"/>
                        <polyline points="7,10 12,15 17,10" stroke="currentColor" stroke-width="2"/>
                        <line x1="12" y1="15" x2="12" y2="3" stroke="currentColor" stroke-width="2"/>
                      </svg>
                      <span>Backup</span>
                    </button>

                    <button class="db-cmd-btn" onclick="adminPanel.runDbCommand('reset')" title="Reiniciar datos">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <polyline points="23,4 23,10 17,10" stroke="currentColor" stroke-width="2"/>
                        <polyline points="1,20 1,14 7,14" stroke="currentColor" stroke-width="2"/>
                        <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15" stroke="currentColor" stroke-width="2"/>
                      </svg>
                      <span>Reset</span>
                    </button>

                    <button class="db-cmd-btn" onclick="adminPanel.restoreDatabase()" title="Restaurar desde backup">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="currentColor" stroke-width="2"/>
                        <polyline points="17,8 12,3 7,8" stroke="currentColor" stroke-width="2"/>
                        <line x1="12" y1="3" x2="12" y2="15" stroke="currentColor" stroke-width="2"/>
                      </svg>
                      <span>Restaurar</span>
                    </button>

                    <button class="db-cmd-btn" onclick="adminPanel.runDbCommand('status')" title="Ver estado">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                        <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2"/>
                      </svg>
                      <span>Estado</span>
                    </button>
                  </div>
                </div>
              </div>

              <!-- PANEL CENTRAL: RESULTADOS -->
              <div class="db-results-panel">
                <!-- Header simplificado -->
                <div class="db-viewer-header">
                  <h3>
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                      <rect x="2" y="3" width="20" height="14" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                      <line x1="8" y1="21" x2="16" y2="21" stroke="currentColor" stroke-width="2"/>
                      <line x1="12" y1="17" x2="12" y2="21" stroke="currentColor" stroke-width="2"/>
                      <line x1="6" y1="8" x2="6" y2="8" stroke="currentColor" stroke-width="2"/>
                      <line x1="10" y1="8" x2="10" y2="8" stroke="currentColor" stroke-width="2"/>
                      <line x1="14" y1="8" x2="14" y2="8" stroke="currentColor" stroke-width="2"/>
                      <line x1="18" y1="8" x2="18" y2="8" stroke="currentColor" stroke-width="2"/>
                      <line x1="6" y1="12" x2="6" y2="12" stroke="currentColor" stroke-width="2"/>
                      <line x1="10" y1="12" x2="10" y2="12" stroke="currentColor" stroke-width="2"/>
                      <line x1="14" y1="12" x2="14" y2="12" stroke="currentColor" stroke-width="2"/>
                      <line x1="18" y1="12" x2="18" y2="12" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    Resultados
                  </h3>
                  <div class="action-buttons">
                    <button class="clear-btn" onclick="adminPanel.clearResults()" title="Limpiar">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                        <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2"/>
                        <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2"/>
                      </svg>
                      <span>Limpiar</span>
                    </button>
                  </div>
                </div>

                <!-- Contenido directo -->
                <div class="results-content" id="resultsContent">
                  <div class="no-results">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
                      <rect x="2" y="3" width="20" height="14" rx="2" ry="2" stroke="currentColor" stroke-width="1.5" opacity="0.3"/>
                      <line x1="8" y1="21" x2="16" y2="21" stroke="currentColor" stroke-width="1.5" opacity="0.3"/>
                      <line x1="12" y1="17" x2="12" y2="21" stroke="currentColor" stroke-width="1.5" opacity="0.3"/>
                      <line x1="6" y1="8" x2="18" y2="8" stroke="currentColor" stroke-width="1.5" opacity="0.3"/>
                      <line x1="6" y1="12" x2="18" y2="12" stroke="currentColor" stroke-width="1.5" opacity="0.3"/>
                      <circle cx="9" cy="10" r="1" fill="currentColor" opacity="0.5"/>
                      <circle cx="15" cy="10" r="1" fill="currentColor" opacity="0.5"/>
                      <circle cx="12" cy="14" r="1" fill="currentColor" opacity="0.5"/>
                    </svg>
                    <p>Selecciona una tabla para ver sus datos</p>
                  </div>
                </div>

                <!-- Resultados de comandos -->
                <div class="db-command-results" id="dbResultsSection" style="display: none">
                  <div class="db-results-header">
                    <h4>Información de Tablas</h4>
                  </div>
                  <div class="db-results-content" id="dbResultsContent">
                    <div class="db-loading">
                      <div class="spinner"></div>
                      <span>Ejecutando comando...</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- PANEL DERECHO: TABLAS -->
              <div class="db-tables-panel">
                <!-- Header simplificado -->
                <div class="db-viewer-header">
                  <h3>
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                      <rect x="2" y="3" width="20" height="14" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                      <line x1="8" y1="21" x2="16" y2="21" stroke="currentColor" stroke-width="2"/>
                      <line x1="12" y1="17" x2="12" y2="21" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    Tablas
                  </h3>
                  <button class="refresh-btn" onclick="adminPanel.refreshTables()" title="Actualizar">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                      <polyline points="23,4 23,10 17,10" stroke="currentColor" stroke-width="2"/>
                      <polyline points="1,20 1,14 7,14" stroke="currentColor" stroke-width="2"/>
                      <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <span>Refresh</span>
                  </button>
                </div>

                <!-- Lista directa -->
                <div class="tables-list" id="tablesList">
                  <div class="db-loading">
                    <div class="spinner"></div>
                    <span>Cargando...</span>
                  </div>
                </div>
              </div>
            </div>

          <!-- TAB 6: SISTEMA AVANZADO -->
          <div class="admin-tab-content" id="tab-sistema-avanzado">
            <h2>Sistema Avanzado</h2>
            <p class="tab-description">
              Configuraciones avanzadas y logs del sistema
            </p>

            <div class="admin-section">
              <h3>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path
                    d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                  <polyline
                    points="14,2 14,8 20,8"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                  <line
                    x1="16"
                    y1="13"
                    x2="8"
                    y2="13"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                  <line
                    x1="16"
                    y1="17"
                    x2="8"
                    y2="17"
                    stroke="currentColor"
                    stroke-width="2"
                  />
                </svg>
                Logs de Actividad
              </h3>

              <div class="logs-container">
                <div class="logs-header">
                  <div class="logs-filters">
                    <select class="admin-select" id="logFilter">
                      <option value="all">Todas las actividades</option>
                      <option value="admin">Solo administrativas</option>
                      <option value="user">Solo usuarios</option>
                      <option value="system">Solo sistema</option>
                    </select>
                    <button class="admin-btn secondary" onclick="refreshLogs()">
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                      >
                        <polyline
                          points="23,4 23,10 17,10"
                          stroke="currentColor"
                          stroke-width="2"
                        />
                        <polyline
                          points="1,20 1,14 7,14"
                          stroke="currentColor"
                          stroke-width="2"
                        />
                        <path
                          d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"
                          stroke="currentColor"
                          stroke-width="2"
                        />
                      </svg>
                      Actualizar
                    </button>
                  </div>
                </div>
                <div class="logs-list" id="systemLogs">
                  <!-- Los logs se cargan dinámicamente -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Modal de confirmación -->
    <div class="admin-modal" id="confirmModal" style="display: none">
      <div class="admin-modal-content">
        <div class="admin-modal-header">
          <h3 id="confirmModalTitle">Confirmar Acción</h3>
          <button class="admin-modal-close" onclick="closeConfirmModal()">
            &times;
          </button>
        </div>
        <div class="admin-modal-body">
          <p id="confirmModalMessage">
            ¿Estás seguro de que quieres realizar esta acción?
          </p>
        </div>
        <div class="admin-modal-footer">
          <button
            class="admin-btn danger"
            id="confirmModalBtn"
            onclick="executeConfirmedAction()"
          >
            Confirmar
          </button>
          <button class="admin-btn secondary" onclick="closeConfirmModal()">
            Cancelar
          </button>
        </div>
      </div>
    </div>

    <!-- Loading overlay -->
    <div class="admin-loading" id="adminLoading" style="display: none">
      <div class="admin-loading-content">
        <div class="admin-spinner"></div>
        <p>Procesando...</p>
      </div>
    </div>

    <!-- Script de validación de autenticación de máxima seguridad -->
    <!-- Scripts del sistema administrativo -->
    <script src="/scripts/frontend/notifications.js"></script>
    <script src="/admin/js/admin.frontend.js"></script>
    <script src="/admin/js/user-management.js"></script>
    <script src="/admin/js/advanced-config.js"></script>

    <!-- Inicialización del AdminPanel -->
    <script>
      // Crear instancia global del AdminPanel después de que se carguen los scripts
      document.addEventListener('DOMContentLoaded', function() {
        window.adminPanel = new AdminPanel();

        // Cargar configuración de institución al iniciar
        if (window.adminPanel && window.adminPanel.loadInstitutionConfig) {
          window.adminPanel.loadInstitutionConfig();
        }
      });
    </script>

    <!-- Sistema unificado de temas -->
    <script src="/scripts/utils/themeManager.js"></script>
    <script src="/scripts/frontend/visualConfig.frontend.js"></script>

    <!-- Inicialización de backgrounds para panel admin -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Inicializar backgrounds en el panel de administración
        const visualManager = new VisualCustomizationManager();

        // Marcar el background actualmente activo
        setTimeout(() => {
          const currentBg = localStorage.getItem('globalBackground') || 'fondo1';
          const activeOption = document.querySelector(`[data-bg="${currentBg}"]`);
          if (activeOption) {
            activeOption.classList.add('selected');
          }

          // Verificación de estilos CSS aplicados para backgrounds
          console.log('🎨 Verificación de estilos CSS para backgrounds:');
          const backgroundCards = document.querySelectorAll('.background-option-card');
          backgroundCards.forEach((card, index) => {
            const computedStyle = window.getComputedStyle(card);
            console.log(`📋 Card ${index + 1}:`, {
              borderColor: computedStyle.borderColor,
              boxShadow: computedStyle.boxShadow,
              transform: computedStyle.transform,
              backgroundColor: computedStyle.backgroundColor
            });
          });

          if (backgroundCards.length > 0) {
            console.log('✅ Estilos CSS aplicados correctamente para backgrounds');
          } else {
            console.log('ℹ️ No se encontraron cards de background (esto es normal si no hay backgrounds configurados)');
          }
        }, 100);
      });
    </script>

    <!-- Scripts principales del panel administrativo -->
    <script src="/admin/js/panelAdmin.js"></script>
  </body>
</html>
